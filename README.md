# 広告宣伝費最適化ダッシュボード

## 📋 概要

このアプリケーションは、Streamlitで構築された広告宣伝費の最適化・分析ダッシュボードです。複数の広告媒体に対する予算配分を最適化し、効果検証を行うための包括的なツールを提供します。

---

## 🔐 認証機能

- SHA-256によるパスワードハッシュ化
- セッションベースの認証状態管理
- `st.secrets`による本番環境での認証情報管理対応
- ログイン/ログアウト機能

---

## 📊 主要機能

### 1. 📈 現状把握（媒体別パフォーマンス分析）

各広告媒体のパフォーマンスを可視化・分析する機能です。

#### 対応モデル
| モデル | 説明 |
|--------|------|
| **Hill Model** | 飽和効果を表現する非線形モデル。広告費が増えるにつれて効果が逓減する関係をモデル化 |
| **線形回帰** | 広告費と成果の線形関係をモデル化 |

#### 機能詳細
- **媒体別設定**: 各媒体ごとに学習期間、目的変数、モデルタイプを個別設定可能
- **一括設定**: 全媒体に同一設定を一括適用
- **ベイズ推定**: PyMCを使用したベイズ統計モデリング（MCMC: 10,000サンプル、4チェーン）
- **可視化**:
  - 広告費と成果の散布図
  - 回帰曲線と95%信用区間
  - 直近4週間のデータをハイライト表示
  - R²スコアによるモデル精度評価
- **全媒体比較**: Hill関数曲線を同一グラフ上に表示し、費用対効果を比較

---

### 2. 🎯 投資費用最適化（予算配分最適化）

限られた総予算を複数媒体に最適配分するための機能です。

#### 対応モデル
| モデル | 説明 |
|--------|------|
| **Hill Model** | 飽和曲線による非線形最適化 |
| **線形回帰** | 線形関係に基づく最適化 |
| **GAM** | 一般化加法モデルによる柔軟な非線形最適化 |

#### 最適化アルゴリズム
- **手法**: SLSQP（Sequential Least Squares Programming）
- **マルチスタート法**: ローカル最適解を回避するため複数の初期値から最適化を実行

#### 制約条件
- **総予算制約**: 配分合計 = 総予算
- **最低予算制約**: 各媒体の過去データから算出（0円を除く下位3件の平均）
- **優先媒体制約**: 特定媒体への配分比率を指定可能
- **キャリアインデックス上限**: 1,000万円の予算上限（ハードコード）

#### 出力
- 媒体別の最適配分予算と予算比率
- 予測成果
- 制約充足の確認テーブル

---

### 3. 🔍 事前効果検証（前半）- シナリオ比較

2つの予算配分案をモンテカルロシミュレーションで確率的に比較する機能です。

#### 機能概要
- **シナリオ1**: システム提案（最適化案）
- **シナリオ2**: 現場担当者提案

#### シミュレーション手法
- **モンテカルロシミュレーション**: 1,000〜10,000回の試行
- **不確実性の考慮**:
  - Hill/Linear: ベイズ事後分布からのサンプリング
  - GAM: ブートストラップ法による信頼区間推定

#### 出力
- シナリオ比較サマリー（期待値、中央値）
- **勝率**: シナリオ1がシナリオ2を上回る確率
- 予測成果の確率分布（ヒストグラム）
- 媒体別の詳細分析
  - 各媒体の予測成果比較表
  - 媒体別の予測成果分布グラフ
  - 統計情報（平均、中央値、標準偏差、パーセンタイル）

---

### 4. 📊 事前効果検証（後半）- Prophet時系列予測

Prophetを使用した時系列予測の精度検証機能です。

#### ワークフロー
```
Step 1: モデル学習設定
    ↓
Step 2: 検証期間設定（1〜12週先）
    ↓
Step 3: モデル学習と予測実行
    ↓
Step 4: 結果の可視化と比較
    ↓
Step 5: 精度評価指標の算出
```

#### Prophetモデル設定
| パラメータ | 設定値 |
|-----------|--------|
| growth | logistic（飽和成長） |
| yearly_seasonality | True |
| weekly_seasonality | True |
| seasonality_mode | multiplicative |
| changepoint_prior_scale | 0.01 |
| seasonality_prior_scale | 5.0 |
| 外部変数 | total_spend（広告費） |

#### 精度評価指標
| 指標 | 説明 |
|------|------|
| **MAE** | 平均絶対誤差 |
| **RMSE** | 二乗平均平方根誤差 |
| **MAPE** | 平均絶対誤差率（%） |
| **信頼区間カバレッジ** | 実績が95%信頼区間内に入る割合 |

---

## 🛠️ 技術スタック

| カテゴリ | ライブラリ |
|----------|------------|
| **UI** | Streamlit |
| **データ処理** | Pandas, NumPy |
| **可視化** | Plotly |
| **ベイズ推定** | PyMC, ArviZ |
| **機械学習** | scikit-learn |
| **GAM** | pygam |
| **時系列予測** | Prophet |
| **最適化** | SciPy (minimize) |

---

## 📁 データ要件

### 入力データ形式（CSV）

必須カラム:
| カラム名 | 説明 |
|----------|------|
| `week_start_date` | 週開始日（日付型） |
| `channel` | 媒体名 |
| `total_spend` | 広告宣伝費 |
| `*応募*` または `*コンバージョン*` | 目的変数（カラム名に「応募」または「コンバージョン」を含む） |

### データ読み込み方法
1. **st.secrets経由**: `data_path`を設定（本番環境推奨）
2. **ファイルアップロード**: サイドバーからCSVをアップロード

---

## 🔧 セッション状態管理

| 変数名 | 用途 |
|--------|------|
| `authenticated` | 認証状態 |
| `username` | ログインユーザー名 |
| `trained_models` | 学習済みモデル（現状把握） |
| `optimization_result` | 最適化結果 |
| `all_channel_results` | 全媒体の分析結果 |
| `combined_df` | 読み込んだデータ |
| `optimization_models` | 最適化用モデル |
| `comparison_result` | シナリオ比較結果 |

---

## 📐 数理モデル詳細

### Hill関数モデル
```
y = Vmax × x / (EC50 + x)
```
- `Vmax`: 最大効果（slope × EC50から算出）
- `EC50`: 半最大効果濃度（効果が最大の50%になる広告費）
- `x`: 広告宣伝費

### 線形回帰モデル
```
y = α + β × x
```
- `α`: 切片（広告費0時のベースライン効果）
- `β`: 傾き（広告費1円あたりの効果）

### GAM（一般化加法モデル）
```
y = s(x)
```
- `s()`: 単調増加制約付きスプライン関数

---

## ⚠️ 注意事項

1. **最低データ件数**: 各媒体で最低5件以上のデータが必要（GAMは10件以上）
2. **計算時間**: MCMC推定には時間がかかる場合があります
3. **キャリアインデックス制約**: 1,000万円の上限がハードコードされています
4. **デフォルト期間**: データの最新日から4ヶ月前が学習期間の開始日として設定

---

## 📅 データ更新情報

- **最終更新日**: 2025年12月7日
- **データ期間**: 2024年1月 - 2025年12月

---

## 🚀 使い方

1. アプリを起動
2. ユーザー名・パスワードでログイン
3. サイドバーからCSVデータをアップロード（または自動読み込み）
4. 分析メニューから機能を選択
5. パラメータを設定して分析を実行

---

© 2025 広告最適化ツール










